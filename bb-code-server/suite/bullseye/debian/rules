#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

code_server_version=4.0.0

# Disable dh_link
override_dh_link:

# Disable dh_strip
override_dh_strip:

# Disable dh_strip_nondeterminism
override_dh_strip_nondeterminism:

# Disable dh_shlibdeps
override_dh_shlibdeps:

override_dh_auto_configure:
	mkdir -p ./tmp/opt/bb-code-server/app/
	tar xf debian/code-server-$(code_server_version)-linux-arm64.tar.gz -C ./tmp/opt/bb-code-server/app/ --strip-components 1
	mkdir -p /opt/bb-code-server/examples/
	git clone https://github.com/beagleboard/VSX-examples /opt/bb-code-server/examples/ --branch main --depth 1
	cd /opt/bb-code-server/examples/ ; git config user.email "beagle@beagleboard.org" ; git config user.name "BeagleBoard"
	mv /opt/bb-code-server/examples/.git/ /opt/bb-code-server/examples/dotgit/
	mv /opt/bb-code-server/examples/.gitignore /opt/bb-code-server/examples/dotgitignore
	mkdir -p ./tmp/opt/bb-code-server/examples/
	mv /opt/bb-code-server/examples/* ./tmp/opt/bb-code-server/examples/

%:
	dh $@ --with systemd

override_dh_installinit:
	dh_installinit --name=bb-code-server --no-stop-on-upgrade --no-start

override_dh_systemd_enable:
	dh_systemd_enable --name=bb-code-server --no-enable

override_dh_systemd_start:
	dh_systemd_start --name=bb-code-server --no-start
