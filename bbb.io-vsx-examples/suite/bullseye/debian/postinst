#!/bin/sh
#
# see: dh_installdeb(1)

set -e

main_install () {
	chown -R 1000:1000 /opt/vsx-examples/examples/ || true

	if [ -d /opt/vsx-examples/examples/dotgit/ ] ; then
		mv /opt/vsx-examples/examples/dotgit/ /opt/vsx-examples/examples/.git/
	fi

	if [ -f /opt/vsx-examples/examples/dotgitignore ] ; then
		mv /opt/vsx-examples/examples/dotgitignore /opt/vsx-examples/examples/.gitignore
	fi

	echo "Updating Code Server examples from: https://github.com/beagleboard/vsx-examples"
	cd /opt/vsx-examples/examples/
	git config --global --add safe.directory /opt/vsx-examples/examples
	git reset HEAD --hard
	git pull || true

	if [ ! -f /usr/bin/nodejs ] ; then
		ln -sf /usr/bin/node /usr/bin/nodejs
	fi

	chown -R 1000:1000 /opt/vsx-examples/examples/ || true
}

case "$1" in
    configure)
        main_install
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
